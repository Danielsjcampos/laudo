version: '3.8'

services:
  backend:
    image: ghcr.io/danielsjcampos/laudo-backend:main
    container_name: laudodigital-backend
    restart: always
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
      - DATABASE_URL=${DATABASE_URL:-postgresql://neondb_owner:npg_x3Q5lLutDkHV@ep-jolly-bird-acludz09-pooler.sa-east-1.aws.neon.tech/neondb?sslmode=require}
      - JWT_SECRET=${JWT_SECRET:-sua_chave_secreta_aqui_123}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    networks:
      - laudodigital-net

  frontend:
    image: ghcr.io/danielsjcampos/laudo-frontend:main
    container_name: laudodigital-frontend
    restart: always
    ports:
      - "3003:80"
    environment:
      - VITE_API_URL=https://laudo.2b.app.br/api
    depends_on:
      - backend
    networks:
      - laudodigital-net

  ohif:
    image: ghcr.io/danielsjcampos/laudo-ohif:main
    container_name: laudodigital-ohif
    restart: always
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - laudodigital-net

networks:
  laudodigital-net:
    driver: overlay # Necessário no modo swarm para comunicação entre containers em diferentes nós, ou bridge caso não utilize swarm nativo via Docker

volumes:
  laudodigital-db-data:
